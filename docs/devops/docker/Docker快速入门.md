# ğŸ‰ Docker ç®€ä»‹å’Œå®‰è£…

### Docker æ˜¯ä»€ä¹ˆ

Docker æ˜¯ä¸€ä¸ªåº”ç”¨æ‰“åŒ…ã€åˆ†å‘ã€éƒ¨ç½²çš„å·¥å…·
ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªè½»é‡çš„è™šæ‹Ÿæœºï¼Œå®ƒåªè™šæ‹Ÿä½ è½¯ä»¶éœ€è¦çš„è¿è¡Œç¯å¢ƒï¼Œå¤šä½™çš„ä¸€ç‚¹éƒ½ä¸è¦ï¼Œ
è€Œæ™®é€šè™šæ‹Ÿæœºåˆ™æ˜¯ä¸€ä¸ªå®Œæ•´è€Œåºå¤§çš„ç³»ç»Ÿï¼ŒåŒ…å«å„ç§ä¸ç®¡ä½ è¦ä¸è¦çš„è½¯ä»¶ã€‚

### è·Ÿæ™®é€šè™šæ‹Ÿæœºçš„å¯¹æ¯”

| ç‰¹æ€§   | æ™®é€šè™šæ‹Ÿæœº                                                   | Docker                                               |
| ------ | ------------------------------------------------------------ | ---------------------------------------------------- |
| è·¨å¹³å° | é€šå¸¸åªèƒ½åœ¨æ¡Œé¢çº§ç³»ç»Ÿè¿è¡Œï¼Œä¾‹å¦‚ Windows/Macï¼Œæ— æ³•åœ¨ä¸å¸¦å›¾å½¢ç•Œé¢çš„æœåŠ¡å™¨ä¸Šè¿è¡Œ | æ”¯æŒçš„ç³»ç»Ÿéå¸¸å¤šï¼Œå„ç±» windows å’Œ Linux éƒ½æ”¯æŒ       |
| æ€§èƒ½   | æ€§èƒ½æŸè€—å¤§ï¼Œå†…å­˜å ç”¨é«˜ï¼Œå› ä¸ºæ˜¯æŠŠæ•´ä¸ªå®Œæ•´ç³»ç»Ÿéƒ½è™šæ‹Ÿå‡ºæ¥äº†     | æ€§èƒ½å¥½ï¼Œåªè™šæ‹Ÿè½¯ä»¶æ‰€éœ€è¿è¡Œç¯å¢ƒï¼Œæœ€å¤§åŒ–å‡å°‘æ²¡ç”¨çš„é…ç½® |
| è‡ªåŠ¨åŒ– | éœ€è¦æ‰‹åŠ¨å®‰è£…æ‰€æœ‰ä¸œè¥¿                                         | ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥è‡ªåŠ¨éƒ¨ç½²å¥½æ‰€éœ€ç¯å¢ƒ                     |
| ç¨³å®šæ€§ | ç¨³å®šæ€§ä¸é«˜ï¼Œä¸åŒç³»ç»Ÿå·®å¼‚å¤§                                   | ç¨³å®šæ€§å¥½ï¼Œä¸åŒç³»ç»Ÿéƒ½ä¸€æ ·éƒ¨ç½²æ–¹å¼                     |

### æ‰“åŒ…ã€åˆ†å‘ã€éƒ¨ç½²

**æ‰“åŒ…**ï¼šå°±æ˜¯æŠŠä½ è½¯ä»¶è¿è¡Œæ‰€éœ€çš„ä¾èµ–ã€ç¬¬ä¸‰æ–¹åº“ã€è½¯ä»¶æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå˜æˆä¸€ä¸ªå®‰è£…åŒ…
**åˆ†å‘**ï¼šä½ å¯ä»¥æŠŠä½ æ‰“åŒ…å¥½çš„â€œå®‰è£…åŒ…â€ä¸Šä¼ åˆ°ä¸€ä¸ªé•œåƒä»“åº“ï¼Œå…¶ä»–äººå¯ä»¥éå¸¸æ–¹ä¾¿çš„è·å–å’Œå®‰è£…
**éƒ¨ç½²**ï¼šæ‹¿ç€â€œå®‰è£…åŒ…â€å°±å¯ä»¥ä¸€ä¸ªå‘½ä»¤è¿è¡Œèµ·æ¥ä½ çš„åº”ç”¨ï¼Œè‡ªåŠ¨æ¨¡æ‹Ÿå‡ºä¸€æ‘¸ä¸€æ ·çš„è¿è¡Œç¯å¢ƒï¼Œä¸ç®¡æ˜¯åœ¨ Windows/Mac/Linuxã€‚
![image.png](https://sjwx.easydoc.xyz/46901064/files/kv7rlicu.png)

### Docker éƒ¨ç½²çš„ä¼˜åŠ¿

å¸¸è§„åº”ç”¨å¼€å‘éƒ¨ç½²æ–¹å¼ï¼šè‡ªå·±åœ¨ Windows ä¸Šå¼€å‘ã€æµ‹è¯• --> åˆ° Linux æœåŠ¡å™¨é…ç½®è¿è¡Œç¯å¢ƒéƒ¨ç½²ã€‚

> é—®é¢˜ï¼šæˆ‘æœºå™¨ä¸Šè·‘éƒ½æ²¡é—®é¢˜ï¼Œæ€ä¹ˆåˆ°æœåŠ¡å™¨å°±å„ç§é—®é¢˜äº†

ç”¨ Docker å¼€å‘éƒ¨ç½²æµç¨‹ï¼šè‡ªå·±åœ¨ Windows ä¸Šå¼€å‘ã€æµ‹è¯• --> æ‰“åŒ…ä¸º Docker é•œåƒï¼ˆå¯ä»¥ç†è§£ä¸ºè½¯ä»¶å®‰è£…åŒ…ï¼‰ --> å„ç§æœåŠ¡å™¨ä¸Šåªéœ€è¦ä¸€ä¸ªå‘½ä»¤éƒ¨ç½²å¥½

> ä¼˜ç‚¹ï¼šç¡®ä¿äº†ä¸åŒæœºå™¨ä¸Šè·‘éƒ½æ˜¯ä¸€è‡´çš„è¿è¡Œç¯å¢ƒï¼Œä¸ä¼šå‡ºç°æˆ‘æœºå™¨ä¸Šè·‘æ­£å¸¸ï¼Œä½ æœºå™¨è·‘å°±æœ‰é—®é¢˜çš„æƒ…å†µã€‚

ä¾‹å¦‚ [æ˜“æ–‡æ¡£](https://easydoc.net/)ï¼Œ[SVNBucket](https://svnbucket.com/) çš„ç§æœ‰åŒ–éƒ¨ç½²å°±æ˜¯ç”¨ Dockerï¼Œè½»æ¾åº”å¯¹å®¢æˆ·çš„å„ç§æœåŠ¡å™¨ã€‚

### Docker é€šå¸¸ç”¨æ¥åšä»€ä¹ˆ

- åº”ç”¨åˆ†å‘ã€éƒ¨ç½²ï¼Œæ–¹ä¾¿ä¼ æ’­ç»™ä»–äººå®‰è£…ã€‚ç‰¹åˆ«æ˜¯å¼€æºè½¯ä»¶å’Œæä¾›ç§æœ‰éƒ¨ç½²çš„åº”ç”¨
- å¿«é€Ÿå®‰è£…æµ‹è¯•/å­¦ä¹ è½¯ä»¶ï¼Œç”¨å®Œå°±ä¸¢ï¼ˆç±»ä¼¼å°ç¨‹åºï¼‰ï¼Œä¸æŠŠæ—¶é—´æµªè´¹åœ¨å®‰è£…è½¯ä»¶ä¸Šã€‚ä¾‹å¦‚ Redis / MongoDB / ElasticSearch / ELK
- å¤šä¸ªç‰ˆæœ¬è½¯ä»¶å…±å­˜ï¼Œä¸æ±¡æŸ“ç³»ç»Ÿï¼Œä¾‹å¦‚ Python2ã€Python3ï¼ŒRedis4.0ï¼ŒRedis5.0
- Windows ä¸Šä½“éªŒ/å­¦ä¹ å„ç§ Linux ç³»ç»Ÿ

### é‡è¦æ¦‚å¿µï¼šé•œåƒã€å®¹å™¨

**é•œåƒ**ï¼šå¯ä»¥ç†è§£ä¸ºè½¯ä»¶å®‰è£…åŒ…ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œä¼ æ’­å’Œå®‰è£…ã€‚
**å®¹å™¨**ï¼šè½¯ä»¶å®‰è£…åçš„çŠ¶æ€ï¼Œæ¯ä¸ªè½¯ä»¶è¿è¡Œç¯å¢ƒéƒ½æ˜¯ç‹¬ç«‹çš„ã€éš”ç¦»çš„ï¼Œç§°ä¹‹ä¸ºå®¹å™¨ã€‚

### å®‰è£…

æ¡Œé¢ç‰ˆï¼šhttps://www.docker.com/products/docker-desktop

æœåŠ¡å™¨ç‰ˆï¼šhttps://docs.docker.com/engine/install/#server

### æ›´å¤šç›¸å…³å‘½ä»¤

- `docker ps` æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„å®¹å™¨
- `docker images` æŸ¥çœ‹é•œåƒåˆ—è¡¨
- `docker rm container-id` åˆ é™¤æŒ‡å®š id çš„å®¹å™¨
- `docker stop/start container-id` åœæ­¢/å¯åŠ¨æŒ‡å®š id çš„å®¹å™¨
- `docker rmi image-id` åˆ é™¤æŒ‡å®š id çš„é•œåƒ
- `docker volume ls` æŸ¥çœ‹ volume åˆ—è¡¨
- `docker network ls` æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨



### é•œåƒåŠ é€Ÿæº

| é•œåƒåŠ é€Ÿå™¨          | é•œåƒåŠ é€Ÿå™¨åœ°å€                          |
| ------------------- | --------------------------------------- |
| Docker ä¸­å›½å®˜æ–¹é•œåƒ | https://registry.docker-cn.com          |
| DaoCloud é•œåƒç«™     | http://f1361db2.m.daocloud.io           |
| Azure ä¸­å›½é•œåƒ      | https://dockerhub.azk8s.cn              |
| ç§‘å¤§é•œåƒç«™          | https://docker.mirrors.ustc.edu.cn      |
| é˜¿é‡Œäº‘              | https://<your_code>.mirror.aliyuncs.com |
| ä¸ƒç‰›äº‘              | https://reg-mirror.qiniu.com            |
| ç½‘æ˜“äº‘              | https://hub-mirror.c.163.com            |
| è…¾è®¯äº‘              | https://mirror.ccs.tencentyun.com       |

![image.png](https://sjwx.easydoc.xyz/46901064/files/kv94feox.png)



# ğŸ’» Docker å¿«é€Ÿå®‰è£…è½¯ä»¶

### ç›´æ¥å®‰è£…çš„ç¼ºç‚¹

- å®‰è£…éº»çƒ¦ï¼Œå¯èƒ½æœ‰å„ç§ä¾èµ–ï¼Œè¿è¡ŒæŠ¥é”™ã€‚ä¾‹å¦‚ï¼šWordPressï¼ŒElasticSearchï¼ŒRedisï¼ŒELK
- å¯èƒ½å¯¹ Windows å¹¶ä¸å‹å¥½ï¼Œè¿è¡Œæœ‰å„ç§å…¼å®¹é—®é¢˜ï¼Œè½¯ä»¶åªæ”¯æŒ Linux ä¸Šè·‘
- ä¸æ–¹ä¾¿å®‰è£…å¤šç‰ˆæœ¬è½¯ä»¶ï¼Œä¸èƒ½å…±å­˜ã€‚
- ç”µè„‘å®‰è£…äº†ä¸€å †è½¯ä»¶ï¼Œæ‹–æ…¢ç”µè„‘é€Ÿåº¦ã€‚
- ä¸åŒç³»ç»Ÿå’Œç¡¬ä»¶ï¼Œå®‰è£…æ–¹å¼ä¸ä¸€æ ·

### Docker å®‰è£…çš„ä¼˜ç‚¹

- ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥å®‰è£…å¥½ï¼Œå¿«é€Ÿæ–¹ä¾¿
- æœ‰å¤§é‡çš„é•œåƒï¼Œå¯ç›´æ¥ä½¿ç”¨
- æ²¡æœ‰ç³»ç»Ÿå…¼å®¹é—®é¢˜ï¼ŒLinux ä¸“äº«è½¯ä»¶ä¹Ÿç…§æ ·è·‘
- æ”¯æŒè½¯ä»¶å¤šç‰ˆæœ¬å…±å­˜
- ç”¨å®Œå°±ä¸¢ï¼Œä¸æ‹–æ…¢ç”µè„‘é€Ÿåº¦
- ä¸åŒç³»ç»Ÿå’Œç¡¬ä»¶ï¼Œåªè¦å®‰è£…å¥½ Docker å…¶ä»–éƒ½ä¸€æ ·äº†ï¼Œä¸€ä¸ªå‘½ä»¤æå®šæ‰€æœ‰

### æ¼”ç¤º Docker å®‰è£… Redis

Redis å®˜ç½‘ï¼šhttps://redis.io/

> å®˜ç½‘ä¸‹è½½å®‰è£…æ•™ç¨‹åªæœ‰æºç å®‰è£…æ–¹å¼ï¼Œæ²¡æœ‰ Windows ç‰ˆæœ¬ã€‚æƒ³è¦è‡ªå·±å®‰è£… windows ç‰ˆæœ¬éœ€è¦å»æ‰¾åˆ«äººç¼–è¯‘å¥½çš„å®‰è£…åŒ…ã€‚

Docker å®˜æ–¹é•œåƒä»“åº“æŸ¥æ‰¾ Redis ï¼šhttps://hub.docker.com/

![Dockeré•œåƒå®˜ç½‘](https://sjwx.easydoc.xyz/46901064/files/kv8zs4qr.png)

ä¸€ä¸ªå‘½ä»¤è·‘èµ·æ¥ï¼š`docker run -d -p 6379:6379 --name redis redis:latest`
å‘½ä»¤å‚è€ƒï¼šhttps://docs.docker.com/engine/reference/commandline/run/

![Dockerè¿è¡ŒRediså](https://sjwx.easydoc.xyz/46901064/files/kv8zy4xn.png)

### å®‰è£… ELK

```
docker run -p 5601:5601 -p 9200:9200 -p 5044:5044 -it --name elk sebp/elk
```

[å†…å­˜ä¸å¤Ÿè§£å†³æ–¹æ³•](https://docs.microsoft.com/en-us/windows/wsl/wsl-config#global-configuration-options-with-wslconfig)
è½¬åˆ°ç”¨æˆ·ç›®å½• `cd ~`ï¼Œè·¯å¾„ç±»ä¼¼è¿™ä¸ªï¼š`C:\Users\<UserName>`
åˆ›å»º `.wslconfig` æ–‡ä»¶å¡«å…¥ä»¥ä¸‹å†…å®¹

```
[wsl2]
memory=10GB # Limits VM memory in WSL 2 to 4 GB
processors=2 # Makes the WSL 2 VM use two virtual processors
```

ç”Ÿæ•ˆé…ç½®ï¼Œå‘½ä»¤è¡Œè¿è¡Œ `wsl --shutdown`



# ğŸ’½ åˆ¶ä½œè‡ªå·±çš„é•œåƒ

### ä¸ºè‡ªå·±çš„ Web é¡¹ç›®æ„å»ºé•œåƒ

ç¤ºä¾‹é¡¹ç›®ä»£ç ï¼šhttps://github.com/gzyunke/test-docker
è¿™æ˜¯ä¸€ä¸ª Nodejs + Koa2 å†™çš„ Web é¡¹ç›®ï¼Œæä¾›äº†ç®€å•çš„ä¸¤ä¸ªæ¼”ç¤ºé¡µé¢ã€‚
è½¯ä»¶ä¾èµ–ï¼šnodejs
é¡¹ç›®ä¾èµ–åº“ï¼škoaã€log4jsã€koa-router

### ç¼–å†™ Dockerfile

```
FROM node:11
MAINTAINER easydoc.net

# å¤åˆ¶ä»£ç 
ADD . /app

# è®¾ç½®å®¹å™¨å¯åŠ¨åçš„é»˜è®¤è¿è¡Œç›®å½•
WORKDIR /app

# è¿è¡Œå‘½ä»¤ï¼Œå®‰è£…ä¾èµ–
# RUN å‘½ä»¤å¯ä»¥æœ‰å¤šä¸ªï¼Œä½†æ˜¯å¯ä»¥ç”¨ && è¿æ¥å¤šä¸ªå‘½ä»¤æ¥å‡å°‘å±‚çº§ã€‚
# ä¾‹å¦‚ RUN npm install && cd /app && mkdir logs
RUN npm install --registry=https://registry.npm.taobao.org

# CMD æŒ‡ä»¤åªèƒ½ä¸€ä¸ªï¼Œæ˜¯å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œç®—æ˜¯ç¨‹åºçš„å…¥å£ã€‚
# å¦‚æœè¿˜éœ€è¦è¿è¡Œå…¶ä»–å‘½ä»¤å¯ä»¥ç”¨ && è¿æ¥ï¼Œä¹Ÿå¯ä»¥å†™æˆä¸€ä¸ªshellè„šæœ¬å»æ‰§è¡Œã€‚
# ä¾‹å¦‚ CMD cd /app && ./start.sh
CMD node app.js
```

[Dockerfileæ–‡æ¡£](https://docs.docker.com/engine/reference/builder/#run)

### Build ä¸ºé•œåƒï¼ˆå®‰è£…åŒ…ï¼‰å’Œè¿è¡Œ

ç¼–è¯‘ `docker build -t test:v1 .`

> `-t` è®¾ç½®é•œåƒåå­—å’Œç‰ˆæœ¬å·
> å‘½ä»¤å‚è€ƒï¼šhttps://docs.docker.com/engine/reference/commandline/build/

è¿è¡Œ `docker run -p 8080:8080 --name test-hello test:v1`

> `-p` æ˜ å°„å®¹å™¨å†…ç«¯å£åˆ°å®¿ä¸»æœº
> `--name` å®¹å™¨åå­—
> `-d` åå°è¿è¡Œ
> å‘½ä»¤å‚è€ƒæ–‡æ¡£ï¼šhttps://docs.docker.com/engine/reference/run/



# ğŸ¥™ ç›®å½•æŒ‚è½½

### ç°å­˜é—®é¢˜

- ä½¿ç”¨ Docker è¿è¡Œåï¼Œæˆ‘ä»¬æ”¹äº†é¡¹ç›®ä»£ç ä¸ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼Œéœ€è¦é‡æ–°`build`å’Œ`run`ï¼Œå¾ˆæ˜¯éº»çƒ¦ã€‚
- å®¹å™¨é‡Œé¢äº§ç”Ÿçš„æ•°æ®ï¼Œä¾‹å¦‚ log æ–‡ä»¶ï¼Œæ•°æ®åº“å¤‡ä»½æ–‡ä»¶ï¼Œå®¹å™¨åˆ é™¤åå°±ä¸¢å¤±äº†ã€‚

> ç›®å½•æŒ‚è½½è§£å†³ä»¥ä¸Šé—®é¢˜

### å‡ ç§æŒ‚è½½æ–¹å¼

- `bind mount` ç›´æ¥æŠŠå®¿ä¸»æœºç›®å½•æ˜ å°„åˆ°å®¹å™¨å†…ï¼Œé€‚åˆæŒ‚ä»£ç ç›®å½•å’Œé…ç½®æ–‡ä»¶ã€‚å¯æŒ‚åˆ°å¤šä¸ªå®¹å™¨ä¸Š
- `volume` ç”±å®¹å™¨åˆ›å»ºå’Œç®¡ç†ï¼Œåˆ›å»ºåœ¨å®¿ä¸»æœºï¼Œæ‰€ä»¥åˆ é™¤å®¹å™¨ä¸ä¼šä¸¢å¤±ï¼Œå®˜æ–¹æ¨èï¼Œæ›´é«˜æ•ˆï¼ŒLinux æ–‡ä»¶ç³»ç»Ÿï¼Œé€‚åˆå­˜å‚¨æ•°æ®åº“æ•°æ®ã€‚å¯æŒ‚åˆ°å¤šä¸ªå®¹å™¨ä¸Š
- `tmpfs mount` é€‚åˆå­˜å‚¨ä¸´æ—¶æ–‡ä»¶ï¼Œå­˜å®¿ä¸»æœºå†…å­˜ä¸­ã€‚ä¸å¯å¤šå®¹å™¨å…±äº«ã€‚

æ–‡æ¡£å‚è€ƒï¼šhttps://docs.docker.com/storage/

![image.png](https://sjwx.easydoc.xyz/46901064/files/kv96dc4q.png)

### æŒ‚è½½æ¼”ç¤º

```
bind mount` æ–¹å¼ç”¨ç»å¯¹è·¯å¾„ `-v D:/code:/app
volume` æ–¹å¼ï¼Œåªéœ€è¦ä¸€ä¸ªåå­— `-v db-data:/app
```

ç¤ºä¾‹ï¼š
`docker run -p 8080:8080 --name test-hello -v D:/code:/app -d test:v1`



# ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦ å¤šå®¹å™¨é€šä¿¡

### å­¦ä¹ ç›®æ ‡

é¡¹ç›®å¾€å¾€éƒ½ä¸æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œéœ€è¦æ•°æ®åº“ã€ç¼“å­˜è¿™äº›ä¸œè¥¿é…åˆè¿ä½œã€‚
è¿™èŠ‚æˆ‘ä»¬æŠŠå‰é¢çš„ Web é¡¹ç›®å¢åŠ ä¸€ä¸ª Redis ä¾èµ–ï¼Œå¤šè·‘ä¸€ä¸ª Redis å®¹å™¨ï¼Œæ¼”ç¤ºå¦‚ä½•å¤šå®¹å™¨ä¹‹é—´çš„é€šä¿¡ã€‚

### åˆ›å»ºè™šæ‹Ÿç½‘ç»œ

è¦æƒ³å¤šå®¹å™¨ä¹‹é—´äº’é€šï¼Œä» Web å®¹å™¨è®¿é—® Redis å®¹å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠä»–ä»¬æ”¾åˆ°åŒä¸ªç½‘ç»œä¸­å°±å¯ä»¥äº†ã€‚

æ–‡æ¡£å‚è€ƒï¼šhttps://docs.docker.com/engine/reference/commandline/network/

### æ¼”ç¤º

##### åˆ›å»ºä¸€ä¸ªåä¸º`test-net`çš„ç½‘ç»œï¼š

```
docker network create test-net
```

##### è¿è¡Œ Redis åœ¨ `test-net` ç½‘ç»œä¸­ï¼Œåˆ«å`redis`

```
docker run -d --name redis --network test-net --network-alias redis redis:latest
```

##### ä¿®æ”¹ä»£ç ä¸­è®¿é—®`redis`çš„åœ°å€ä¸ºç½‘ç»œåˆ«å

![image.png](https://sjwx.easydoc.xyz/46901064/files/kv98rfvb.png)

##### è¿è¡Œ Web é¡¹ç›®ï¼Œä½¿ç”¨åŒä¸ªç½‘ç»œ

```
docker run -p 8080:8080 --name test -v D:/test:/app --network test-net -d test:v1
```

##### æŸ¥çœ‹æ•°æ®

`http://localhost:8080/redis`
å®¹å™¨ç»ˆç«¯æŸ¥çœ‹æ•°æ®æ˜¯å¦ä¸€è‡´

### æ›´å¤šç›¸å…³å‘½ä»¤

- `docker ps` æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„å®¹å™¨
- `docker images` æŸ¥çœ‹é•œåƒåˆ—è¡¨
- `docker rm container-id` åˆ é™¤æŒ‡å®š id çš„å®¹å™¨
- `docker stop/start container-id` åœæ­¢/å¯åŠ¨æŒ‡å®š id çš„å®¹å™¨
- `docker rmi image-id` åˆ é™¤æŒ‡å®š id çš„é•œåƒ
- `docker volume ls` æŸ¥çœ‹ volume åˆ—è¡¨
- `docker network ls` æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨



# ğŸ Docker-Compose

### ç°å­˜é—®é¢˜

åœ¨ä¸ŠèŠ‚ï¼Œæˆ‘ä»¬è¿è¡Œäº†ä¸¤ä¸ªå®¹å™¨ï¼šWeb é¡¹ç›® + Redis
å¦‚æœé¡¹ç›®ä¾èµ–æ›´å¤šçš„ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ç®¡ç†çš„å®¹å™¨å°±æ›´åŠ å¤šï¼Œæ¯ä¸ªéƒ½è¦å•ç‹¬é…ç½®è¿è¡Œï¼ŒæŒ‡å®šç½‘ç»œã€‚
è¿™èŠ‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ docker-compose æŠŠé¡¹ç›®çš„å¤šä¸ªæœåŠ¡é›†åˆåˆ°ä¸€èµ·ï¼Œä¸€é”®è¿è¡Œã€‚

### å®‰è£… Docker Compose

- å¦‚æœä½ æ˜¯å®‰è£…çš„æ¡Œé¢ç‰ˆ Dockerï¼Œä¸éœ€è¦é¢å¤–å®‰è£…ï¼Œå·²ç»åŒ…å«äº†ã€‚
- å¦‚æœæ˜¯æ²¡å›¾å½¢ç•Œé¢çš„æœåŠ¡å™¨ç‰ˆ Dockerï¼Œä½ éœ€è¦å•ç‹¬å®‰è£… [å®‰è£…æ–‡æ¡£](https://docs.docker.com/compose/install/#install-compose-on-linux-systems)
- è¿è¡Œ`docker-compose`æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ

### ç¼–å†™è„šæœ¬

è¦æŠŠé¡¹ç›®ä¾èµ–çš„å¤šä¸ªæœåŠ¡é›†åˆåˆ°ä¸€èµ·ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ª`docker-compose.yml`æ–‡ä»¶ï¼Œæè¿°ä¾èµ–å“ªäº›æœåŠ¡
å‚è€ƒæ–‡æ¡£ï¼šhttps://docs.docker.com/compose/

```
version: "3.7"

services:
  app:
    build: ./
    ports:
      - 80:8080
    volumes:
      - ./:/app
    environment:
      - TZ=Asia/Shanghai
  redis:
    image: redis:5.0.13
    volumes:
      - redis:/data
    environment:
      - TZ=Asia/Shanghai

volumes:
  redis:
```

> å®¹å™¨é»˜è®¤æ—¶é—´ä¸æ˜¯åŒ—äº¬æ—¶é—´ï¼Œå¢åŠ  TZ=Asia/Shanghai å¯ä»¥æ”¹ä¸ºåŒ—äº¬æ—¶é—´

### è·‘èµ·æ¥

åœ¨`docker-compose.yml` æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œï¼š`docker-compose up`å°±å¯ä»¥è·‘èµ·æ¥äº†ã€‚
å‘½ä»¤å‚è€ƒï¼šhttps://docs.docker.com/compose/reference/up/

- åœ¨åå°è¿è¡Œåªéœ€è¦åŠ ä¸€ä¸ª -d å‚æ•°`docker-compose up -d`
- æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼š`docker-compose ps`
- åœæ­¢è¿è¡Œï¼š`docker-compose stop`
- é‡å¯ï¼š`docker-compose restart`
- é‡å¯å•ä¸ªæœåŠ¡ï¼š`docker-compose restart service-name`
- è¿›å…¥å®¹å™¨å‘½ä»¤è¡Œï¼š`docker-compose exec service-name sh`
- æŸ¥çœ‹å®¹å™¨è¿è¡Œlogï¼š`docker-compose logs [service-name]`



# ğŸšš å‘å¸ƒå’Œéƒ¨ç½²

### é•œåƒä»“åº“ä»‹ç»

é•œåƒä»“åº“ç”¨æ¥å­˜å‚¨æˆ‘ä»¬ build å‡ºæ¥çš„â€œå®‰è£…åŒ…â€ï¼ŒDocker å®˜æ–¹æä¾›äº†ä¸€ä¸ª [é•œåƒåº“](https://hub.docker.com/)ï¼Œé‡Œé¢åŒ…å«äº†å¤§é‡é•œåƒï¼ŒåŸºæœ¬å„ç§è½¯ä»¶æ‰€éœ€ä¾èµ–éƒ½æœ‰ï¼Œè¦ä»€ä¹ˆç›´æ¥ä¸Šå»æœç´¢ã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè‡ªå·± build å‡ºæ¥çš„é•œåƒä¸Šä¼ åˆ° docker æä¾›çš„é•œåƒåº“ä¸­ï¼Œæ–¹ä¾¿ä¼ æ’­ã€‚
å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ­å»ºè‡ªå·±çš„ç§æœ‰é•œåƒåº“ï¼Œæˆ–è€…ä½¿ç”¨å›½å†…å„ç§å¤§å‚æä¾›çš„é•œåƒæ‰˜ç®¡æœåŠ¡ï¼Œä¾‹å¦‚ï¼šé˜¿é‡Œäº‘ã€è…¾è®¯äº‘

### ä¸Šä¼ æˆ‘ä»¬çš„é•œåƒ

- é¦–å…ˆä½ è¦å…ˆ [æ³¨å†Œä¸€ä¸ªè´¦å·](https://hub.docker.com/)
- åˆ›å»ºä¸€ä¸ªé•œåƒåº“
- ![image.png](https://sjwx.easydoc.xyz/46901064/files/kv9a2wty.png)
- å‘½ä»¤è¡Œç™»å½•è´¦å·ï¼š
  `docker login -u username`
- æ–°å»ºä¸€ä¸ªtagï¼Œåå­—å¿…é¡»è·Ÿä½ æ³¨å†Œè´¦å·ä¸€æ ·
  `docker tag test:v1 username/test:v1`
- æ¨ä¸Šå»
  `docker push username/test:v1`
- éƒ¨ç½²è¯•ä¸‹
  `docker run -dp 8080:8080 username/test:v1`

##### docker-compose ä¸­ä¹Ÿå¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªé•œåƒäº†

```
version: "3.7"

services:
  app:
#    build: ./
    image: helloguguji/test:v1
    ports:
      - 80:8080
    volumes:
      - ./:/app
    environment:
      - TZ=Asia/Shanghai
  redis:
    image: redis:5.0.13
    volumes:
      - redis:/data
    environment:
      - TZ=Asia/Shanghai

volumes:
  redis:
```



# ğŸ¯ å¤‡ä»½å’Œè¿ç§»æ•°æ®

### è¿ç§»æ–¹å¼ä»‹ç»

- å®¹å™¨ä¸­çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ç”¨æŒ‚è½½ç›®å½•ï¼Œåˆ é™¤å®¹å™¨åå°±ä¼šä¸¢å¤±æ•°æ®ã€‚
- å‰é¢æˆ‘ä»¬å·²ç»è®²è§£äº†å¦‚ä½• [æŒ‚è½½ç›®å½•](doc:kze7f0ZR)
- å¦‚æœä½ æ˜¯ç”¨`bind mount`ç›´æ¥æŠŠå®¿ä¸»æœºçš„ç›®å½•æŒ‚è¿›å»å®¹å™¨ï¼Œé‚£è¿ç§»æ•°æ®å¾ˆæ–¹ä¾¿ï¼Œç›´æ¥å¤åˆ¶ç›®å½•å°±å¥½äº†
- å¦‚æœä½ æ˜¯ç”¨`volume`æ–¹å¼æŒ‚è½½çš„ï¼Œç”±äºæ•°æ®æ˜¯ç”±å®¹å™¨åˆ›å»ºå’Œç®¡ç†çš„ï¼Œéœ€è¦ç”¨ç‰¹æ®Šçš„æ–¹å¼æŠŠæ•°æ®å¼„å‡ºæ¥ã€‚

### å¤‡ä»½å’Œå¯¼å…¥ Volume çš„æµç¨‹

å¤‡ä»½ï¼š

- è¿è¡Œä¸€ä¸ª ubuntu çš„å®¹å™¨ï¼ŒæŒ‚è½½éœ€è¦å¤‡ä»½çš„ volume åˆ°å®¹å™¨ï¼Œå¹¶ä¸”æŒ‚è½½å®¿ä¸»æœºç›®å½•åˆ°å®¹å™¨é‡Œçš„å¤‡ä»½ç›®å½•ã€‚
- è¿è¡Œ tar å‘½ä»¤æŠŠæ•°æ®å‹ç¼©ä¸ºä¸€ä¸ªæ–‡ä»¶
- æŠŠå¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ°éœ€è¦å¯¼å…¥çš„æœºå™¨

å¯¼å…¥ï¼š

- è¿è¡Œ ubuntu å®¹å™¨ï¼ŒæŒ‚è½½å®¹å™¨çš„ volumeï¼Œå¹¶ä¸”æŒ‚è½½å®¿ä¸»æœºå¤‡ä»½æ–‡ä»¶æ‰€åœ¨ç›®å½•åˆ°å®¹å™¨é‡Œ
- è¿è¡Œ tar å‘½ä»¤è§£å‹å¤‡ä»½æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•

### å¤‡ä»½ MongoDB æ•°æ®æ¼”ç¤º

- è¿è¡Œä¸€ä¸ª mongodbï¼Œåˆ›å»ºä¸€ä¸ªåå«`mongo-data`çš„ volume æŒ‡å‘å®¹å™¨çš„ /data ç›®å½•
- `docker run -p 27018:27017 --name mongo -v mongo-data:/data -d mongo:4.4`
- è¿è¡Œä¸€ä¸ª Ubuntu çš„å®¹å™¨ï¼ŒæŒ‚è½½`mongo`å®¹å™¨çš„æ‰€æœ‰ volumeï¼Œæ˜ å°„å®¿ä¸»æœºçš„ backup ç›®å½•åˆ°å®¹å™¨é‡Œé¢çš„ /backup ç›®å½•ï¼Œç„¶åè¿è¡Œ tar å‘½ä»¤æŠŠæ•°æ®å‹ç¼©æ‰“åŒ…
- `docker run --rm --volumes-from mongo -v d:/backup:/backup ubuntu tar cvf /backup/backup.tar /data/`

æœ€åä½ å°±å¯ä»¥æ‹¿ç€è¿™ä¸ª backup.tar æ–‡ä»¶å»å…¶ä»–åœ°æ–¹å¯¼å…¥äº†ã€‚

### æ¢å¤ Volume æ•°æ®æ¼”ç¤º

- è¿è¡Œä¸€ä¸ª ubuntu å®¹å™¨ï¼ŒæŒ‚è½½ mongo å®¹å™¨çš„æ‰€æœ‰ volumesï¼Œç„¶åè¯»å– /backup ç›®å½•ä¸­çš„å¤‡ä»½æ–‡ä»¶ï¼Œè§£å‹åˆ° /data/ ç›®å½•
- `docker run --rm --volumes-from mongo -v d:/backup:/backup ubuntu bash -c "cd /data/ && tar xvf /backup/backup.tar --strip 1"`

> - æ³¨æ„ï¼Œvolumes-from æŒ‡å®šçš„æ˜¯å®¹å™¨åå­—
> - strip 1 è¡¨ç¤ºè§£å‹æ—¶å»æ‰å‰é¢1å±‚ç›®å½•ï¼Œå› ä¸ºå‹ç¼©æ—¶åŒ…å«äº†ç»å¯¹è·¯å¾„



